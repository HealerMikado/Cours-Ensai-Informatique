<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>Le versionnage avec GIT</title></head>
<body><h3>Le versionnage avec GIT</h3>
<p>Ce document couvre les connaissances de bases que vous √™tes sens√© avoir √† la fin de ce cours git. Git est un outil de versionnage de code, ¬´ agnostique ¬ª au langage utilis√©, qui vous servira pour tout vos projets, qu&#39;ils soient Python, R, SAS ou d&#39;un autre langage.</p>
<blockquote><p>‚åõÔ∏è La lecture du document et des diff√©rentes vid√©os devrait vous prendre environ une heure et quart. C&#39;est le temps pass√© l&#39;an dernier pour couvrir les m√™me notions en cours. </p>
<p>Une fois ce FOAD fait vous devrez tester vos connaissances avec un QCM sur Moodle. Une note de 15/20 est attendue pour le valider, vous pouvez faire ce QCM plusieurs fois. <strong>S&#39;il n&#39;est pas valid√©, un malus d&#39;un point sera appliqu√© sur votre note du module.</strong></p>
</blockquote>
<h3>C&#39;est quoi le versionnage ?</h3>
<p>Avant de vous pr√©senter git, il faut bien que vous compreniez le besoin derri√®re la n√©cessit√© d&#39;avoir un syst√®me de versionnage. Vous avez d√©j√† d√ª tous travailler sur un projet un peu long, et avoir diff√©rentes versions de votre travail. Ou travailler sur un seul dossier collaboratif. Mais ces deux m√©thodes de travail, bien que facile d&#39;acc√®s ont des limites importantes que je vais essayer de vous pr√©senter avec diff√©rentes situations fictionnelles, mais que vous avez peut-√™tre d√©j√† d√ª croiser (et que vous rencontrerez peut-√™tre dans le futur).</p>
<p>Les protagonistes de ces situations seront :</p>
<ul>
<li>Le capitaine Holt, il aura le r√¥le de &quot;ma√Ætrise d&#39;ouvrage&quot; (= demandeur, client);</li>
<li>Terry Jeffords, il aura le r√¥le chef de projet ;</li>
<li>Amy Santiago, elle aura le r√¥le de d√©veloppeuse &quot;full stack&quot; (profil polyvalent qui s&#39;y connait aussi bien en code qu&#39;en architecture);</li>
<li>Rosa Diaz, elle aura le r√¥le de d√©veloppeuse senior;</li>
<li>Jake Peralata, il aura le r√¥le de d√©veloppeur senior ;</li>
<li>Charles Boyle, il aura le r√¥le de d√©veloppeur junior.</li>

</ul>
<p>Le capitane Holt demande √† son √©quipe de r√©aliser une application pour automatiser les t√¢ches administrative pour le commissariat du 99i√®me district de New York. Il met donc ses meilleurs √©l√©ments sur ce projet. Au d√©but Amy Santiago avec sa casquette de &quot;full stack&quot; travail encore sur un autre projet et ne participe pas aux premi√®res discussions.</p>
<h4>Un monde sans versionnage et travail dans un dossier partag√©.</h4>
<p>Apr√®s quelques discussion sur la mod√©lisation du projet l&#39;√©quipe est pr√™te √† commencer le codage. D&#39;apr√®s la mod√©lisation l&#39;application est assez simple et devrait √™tre termin√©e en un mois. Terry laisse son √©quipe g√©rer, ce n&#39;est pas le premier projet sur lequel ils travaillent donc ils vont s&#39;en sortir d&#39;apr√®s lui, et il se concentre sur la r√©daction de notes diverses pour montrer que tout avance bien.</p>
<p><img src="https://media.giphy.com/media/26FPqAHtgCBzKG9mo/giphy.gif" referrerpolicy="no-referrer"></p>
<p>Comme le projet est court, Jake, Rosa et Boyle s&#39;accordent pour cr√©er un dossier un projet sur un serveur partag√© et tous travailler dessus. Boyle pr√©viens que √ßa lui semble une mauvaise id√©e, mais on lui dit que tout va bien se passer et il n&#39;insiste pas.</p>
<p>Le premier jour se passent bien le projet avance, mais des le lendemain des probl√®mes arrivent : </p>
<ul>
<li>Quand une personne est en train de travailler sur un fichier, ce fichier se verrouille emp√™chant toutes autre personne de travailler. Tous les logiciels ne font pas √ßa, alors l&#39;√©quipe passe sur un logiciel qui ne verrouille pas les documents ;</li>
<li>Quand une personne modifie le code d&#39;un fichier se fichier ne fonctionne plus tant que la modification n&#39;est pas termin√©e et stable. Donc l&#39;√©quipe va copier coller le dossier sur leur machine, faire les modification et copier/coller les modifications ;</li>
<li>Cela cr√©e un nouveau probl√®me, par moment des modifications sont effac√©es lorsque des modification sont coll√©es sur le serveur partag√© et il n&#39;y a aucun moyen de revenir en arri√®re, n&#39;y d&#39;avoir un historique des modifications.</li>

</ul>
<p>Apr√®s une semaine l&#39;√©quipe passe plus de temps √† g√©rer les probl√®mes qu&#39;ils g√©n√®rent eux m√™me qu&#39;√† coder. Lors de la d√©mo de fin de semaine, l&#39;√©quipe se rend compte que le code sur le dossier ne fonctionne pas ne peut donc rien pr√©senter et le Capitain Holt est tr√®s de√ßu.</p>
<p><img src="https://media.giphy.com/media/9Pk6tjP4BNXmxkOJE7/giphy.gif" referrerpolicy="no-referrer"></p>
<p>Dans le stress de la d√©monstration, Boyle se souvient qu&#39;il a toujours une version de 2 jours qui fonctionne sur sa machine. La d√©monstration est partiellement sauv√©e. Pour √©viter que le d√©sastre se reproduisent Terry d√©cide de mettre en place un syst√®me de versionnage √† la main.</p>
<h4>Versionnage √† la main</h4>
<p>√Ä partir d&#39;aujourd&#39;hui l&#39;√©quipe devra cr√©er une dossier tous les soirs avec un code qui fonctionne. Et voici √† quoi rassemble rapidement le dossier partag√©.</p>
<p><img src="https://raw.githubusercontent.com/HealerMikado/Cours-Ensai-Informatique/master/2A/complement_info/foad2/versionning-no-git.JPG" referrerpolicy="no-referrer"></p>
<p>Apr√®s une semaine plus personne ne sais ce que font les diff√©rentes versions du code. Et m√™me si cette solution √©vite de perdre une journ√©e de code cela ne r√©sout pas l&#39;effacement du code des autres dans la workspace. La tension dans l&#39;√©quipe commence √† monter et la bonne ambiance du d√©but se d√©t√©riore. La confiance entre les membres de l&#39;√©quipe commence √† disparaitre. Et puis l&#39;espace dans le dossier commence √† manquer √† cause de la duplication du code.</p>
<p>Pour couronner le tout de nouvelles fonctionnalit√©s sont demand√©es par le Capitaine Holt qui est arriv√© √† vendre l&#39;application √† d&#39;autres districts. D&#39;un petit projet interne avec un niveau de qualit√© minimal, l&#39;application doit √™tre utilisable dans tous les districts, et chaque district demande quelques fonctionnalit√©s suppl√©mentaires. Une premi√®re version de l&#39;application est attendus pour dans 3 mois avec un jeu de fonctionnalit√© <em>core</em> et le reste dans 9 mois. Terry se rend bien compte qu&#39;il faut changer la mani√®re de travailler sous peine de voir le projet √©chouer et devoir g√©rer une √©quipe qui se d√©teste. Il demande alors √† Amy d&#39;apporter son expertise pour aider l&#39;√©quipe.</p>
<h4>Git la solution</h4>
<p>Venant de terminer un autre projet, Amy ne connait rien au projet en cours. Elle demande alors une petit r√©union pour qu&#39;on lui pr√©sente le projet et les outils utilis√©s. L&#39;√©quipe utilise Pycharm ou VScode comme IDE, ce qui lui convient, et quand on lui montre le dossier avec les 20 versions du code sans r√©el <em>change log</em> elle comprend rapidement pourquoi le projet n&#39;avance pas.</p>
<p><img src="https://media.giphy.com/media/l4JyLz255Lsfc42A0/giphy.gif" referrerpolicy="no-referrer"></p>
<p>Le probl√®me c&#39;est qu&#39;elle est face √† elle 2 d√©veloppeurs senior qui n&#39;aiment pas qu&#39;on critique leur fa√ßon de faire. Au lieu de pr√©senter directement le <em>workflow</em> qu&#39;elle avait mis en place sur son pr√©c√©dent projet, elle va commencer par demander une semaine o√π personne ne travaille sur le projet pour demander une formation git et organiser une journ√©e sous forme de jeu avec git (<a href='https://learngitbranching.js.org/?locale=fr_FR'>jeu avec git</a>).</p>
<p>Apr√®s une prise en main compliqu√©e et quelques couacs, le projet avance bien, et les tensions diminuent. De mauvaise pratiques persistent et des conflit de code se produisent, mais Amy arrivent √† r√©gler les probl√®mes. Le projet est sauv√©.</p>
<p>Je vais arr√™ter notre histoire ici pour la reprendre plus tard et proposer un √©pilogue.</p>
<p>Ce que vous devez en retenir :</p>
<ul>
<li><strong>Travailler dans un fichier collaboratif pour r√©diger du code est une tr√®s mauvaise id√©e !</strong> Il est impossible de travailler √† plusieurs mains en m√™me temps dans cette configuration. En effet d√©s que quelqu&#39;un tape du code le code ne peut pas fonctionner tantque cette personne n&#39;a pas termin√©e. Et m√™me une fois qu&#39;elle a l√¢ch√© le clavier, le code ne va s√ªrement pas fonctionner du premier coup. C&#39;est pour cela qu&#39;il n&#39;existe pas de service comme google doc ou overleaf pour r√©diger du code de fa√ßon synchrone. <strong>Pour pouvoir faire du code √† plusieurs vous devez absolument le faire de mani√®re asynchrone.</strong></li>
<li><strong>Si pour des petits projets scolaires ne pas avoir d&#39;historique n&#39;est pas un gros probl√®me, c&#39;est impensable pour un gros projet d&#39;entreprise qui dure plusieurs ann√©es</strong>. Cela permet de faire des retours en arri√®re rapides en cas d&#39;erreur grave et d&#39;avoir une trace de ce qui a √©t√© fait. Dans ce contexte faire un <em>change log</em> avec les modifications entre les versions est un plus pour savoir jusqu&#39;√† o√π remonter en cas d&#39;erreur.</li>
<li>Cette fiction ne permet pas de le montrer, mais git (ou tout autre syst√®me de gestion de code source d√©centralis√©) ne doit pas rester la propri√©t√© des d√©veloppeurs. Si vous faites du code R, SAS, Julia ou tout autre langage vous pouvez (et devez) utiliser git pour versionner votre code !</li>
<li>N&#39;essayez de r√©inventer un syst√®me de versionnage du code avec une organisation maison du travail !!!</li>

</ul>
<h3>Git, un syst√®me de versionnage</h3>
<p>Git  est un logiciel de versionnage de code source. Il repose sur une <strong>architecture d√©centralis√©e</strong>. Il a √©t√© cr√©√© par <a href='https://fr.wikipedia.org/wiki/Linus_Torvalds'>Linus Torvalds</a>, pour g√©rer les contributions au <a href='https://fr.wikipedia.org/wiki/Noyau_Linux'>noyau Linux</a>. Le fonctionnement de git est loin d&#39;√™tre trivial, et le co√ªt d&#39;entr√©e est loin d&#39;√™tre nul. Mais il est tr√®s largement utilis√© en entreprise et ne pas savoir comment git fonctionne est aujourd&#39;hui un d√©faut pour un data scientist.</p>
<blockquote><p>üßô‚Äç‚ôÇÔ∏è git signifie &quot;connard&quot; en argot britannique. Oui Linus Torvalds est un √™tre adorable =)</p>
</blockquote>
<p>L&#39;architecture de git est une architecture <a href='https://fr.wikipedia.org/wiki/Pair_%C3%A0_pair'><em>peer-to-peer</em></a> m√™me si en g√©n√©ral on va donner un r√¥le diff√©rent √† un des n≈ìuds du syst√®me qui va √™tre le serveur o√π tout le monde r√©cup√®re et pousse le code. Ce serveur est appel√© le serveur le <a href='https://git-scm.com/book/en/v2/Git-Basics-Working-with-Remotes'><em>remote</em></a> ou d√©p√¥t distant ou d√©p√¥t central. Mais si le fait d&#39;avoir ce serveur est une facilit√© car tout le monde va se connecter √† ce serveur pour r√©cup√©rer et pousser du code, il faut bien comprendre <strong>quand vous r√©cup√©rez du code avec git vous allez avoir un d√©p√¥t local sur votre machine qui va contenir l&#39;int√©gralit√© de l&#39;historique git</strong>. Donc si le d√©p√¥t distant venait √† disparaitre, vous aurez toujours sur votre machine tout l&#39;historique du code que vous pourrez d√©poser sur un nouveau d√©p√¥t distant. <strong>Donc vous ne pouvez pas perdre de code d√©pos√© sur le d√©p√¥t distante suite sa disparition.</strong></p>
<h4>L&#39;historique git</h4>
<p>Cette notion d&#39;historique est vraiment le c≈ìur de git, et une fois compris comment fonctionne l&#39;historique vous aurez compris la majeure partie de git. L&#39;historique de git ne contient pas l&#39;int√©gralit√© des modifications que vous avez effectuez sur votre, vous n&#39;allez pas pouvoir faire des sortes de <code>crtl+z</code> pour rapidement retourner √† une version priv√©e de la derni√®re lignes que vous avez modifi√©, mais des <em>snippets</em> (extraits) que vous aurez choisi.</p>
<p>En effet c&#39;est vous qui allez devoir construire &quot;√† la main&quot; l&#39;historique git. Quand vous consid√©rerez que votre code m√©rite d&#39;√™tre historis√© (fin de journ√©e, vous venez de terminer une fonctionnalit√© etc) vous allez faire un <em>commit</em>. C&#39;est √† dire prendre le code que vous voulez historiser et le mettre dans l&#39;historique. Mais votre historique n&#39;est pas forc√©ment un enchainement lin√©aire de <em>commits</em> et par moment vous pouvez faire diverger votre code pour ensuite le refaire converger. Cela peut √™tre volontaire en faisant des branches ou involontaire en travaillant √† plusieurs et en cr√©ant des conflits.</p>
<p><img src="https://raw.githubusercontent.com/HealerMikado/Cours-Ensai-Informatique/master/2A/complement_info/foad2/historique%20git.png" referrerpolicy="no-referrer"></p>
<p>Vous l&#39;aurez compris l&#39;historique va contenir beaucoup d&#39;informations. Et pour √©viter de prendre une place consid√©rable, git ne fonctionne que par diff√©rence. Quand vous allez faire un <em>commit</em>, ce n&#39;est pas le code que vous ajoutez que git va m√©moriser, mais le diff√©rentiel entre ce <em>commit</em> et le <em>commit</em> pr√©c√©dent. Comme √ßa pas de duplication inutile de code.</p>
<h4>Git workflow</h4>
<p>Parlons un peu plus en d√©tail du <em>workflow</em> de git. Car pour bien utiliser git vous allez devoir faire plusieurs commandes dans un certains ordres pr√©cis. Voici un petit enchainement qui permet de r√©cup√©rer le code du serveur distant, le modifier, et envoyer vos modification sur le serveur.</p>
<ol start='' >
<li>Du code source est pr√©sent sur le serveur distant. Un utilisateur (Jake) va cloner le code du serveur distant sur sa machine avec l&#39;instruction <code>git clone</code> (<a href='https://git-scm.com/docs/git-clone'>documentation</a>) si c&#39;est la premi√®re fois qu&#39;il r√©cup√®re le code ou un <code>git pull</code> (<a href='https://git-scm.com/docs/git-pull'>documentation</a>) s&#39;il veut seulement r√©cup√©rer la derni√®re version du code car il poss√®de une version ancienne. <strong>Il va r√©cup√©rer le code courant mais √©galement l&#39;int√©gralit√© de l&#39;historique du code sur sa machine</strong> ;</li>
<li>Il va ensuite faire des modifications sur le code;</li>
<li>Pour que git les prennent en compte il va devoir faire <code>git add file1.py file.py</code> (si les fichiers modifi√©s sont file1.py et file2.py) (<a href='https://git-scm.com/docs/git-add'>documentation</a>). Il peut √©galement faire <code>git add .</code> ou <code>git add --all</code> pour que git prennent en compte tous les fichiers modifi√©s ;</li>
<li>L&#39;√©tape suivante est de faire une <code>git commit</code> (<a href='https://git-scm.com/docs/git-commit'>documentation</a>) cela va cr√©er une nouvelle entr√©e dans historique git. Le code est pour le moment uniquement pr√©sent sur la machine de Jake ; </li>
<li>Enfin Jake va faire un <code>git push</code> (<a href='https://git-scm.com/docs/git-push'>documentation</a>) pour pousser son code sur le d√©p√¥t distant et le rendre accessible √† tout le monde.</li>

</ol>
<p><img src="https://raw.githubusercontent.com/HealerMikado/Cours-Ensai-Informatique/master/2A/complement_info/foad2/git%20d%C3%A9butant.png" referrerpolicy="no-referrer" alt="Worklow basique gi. R√©cup√©ration du code du d√©p√¥t distant, modification des fichiers, git add, git push et dit commit"></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Une chose √† comprendre pour bien utiliser git est la notion de cycle de vie de vos fichiers. En effet il ne suffit pas de modifier une fichier et de le pousser (<em>push</em>) sur le serveur distant pour que ce fichier soit accessible √† tous. Il y a plusieurs √©tapes √† faire dans le bon ordre. </p>
<h5>Fichier existant</h5>
<p>Le premier cas et le plus courant et quand vous allez mettre √† jour un fichier dans votre <em>workspace</em>. Comme git √† d√©j√† connaissance du fichier il va d√©tecter qu&#39;il a √©t√© modifi√© car son <em>hash</em> (r√©sultat d&#39;une fonction de hachage) sera diff√©rent. Mais sans action de votre part il ne va rien faire (il faut bien comprendre que git ne fait que ce que vous lui dites). En faisant un <code>git add votreFichier</code> vous allez placer votre fichier dans une zone tampon appel√©e <em>staging index</em> ou <em>stating area</em>. Rien de vous emp√™che de continuer √† modifier votre fichier, mais il faut bien comprendre √† partir de l√†, deux versions de votre fichier existent, celle de votre <em>workspace</em> et celle de votre <em>staging index</em> (qui vous est cach√©e, mais si besoin vous pouvez r√©cup√©rer cette version). Vous pouvez √©galement modifier d&#39;autres fichier et les mettre dans le <em>staging index</em>. </p>
<p>Une fois le travail en cours termin√©, vous allez faire un <em>commit</em>, c&#39;est √† dire prendre le contenu de votre <em>staging index</em> et cr√©er une nouvelle entr√©e dans l&#39;historique git avec. Pour faire un commit il faut taper <code>git commit -m &quot;message de commit&quot;</code> (avec &quot;message de commit&quot; un court message explicatif entre &quot; &quot; qui explique le contenu du <em>commit</em>). En plus d&#39;ajouter une entr√©e dans l&#39;historique, git va consid√©rer vos fichiers comme <em>Unmodified</em>. En effet votre fichier est d√©sormais coh√©rent avec la version la plus r√©cente de l&#39;historique donc pour git il est d√©sormais <em>Unmodified</em>. Par contre pour le moment ce fichier (et les autre que vous avez <em>commit</em>) sont toujours que sur votre ordinateur dans votre d√©p√¥t local.</p>
<h5>Nouveau fichier</h5>
<p>Dans le cas d&#39;un nouveau fichier les commandes vont √™tre les m√™me, mais la philosophie derri√®re va √™tre un peu diff√©rente. En effet quand vous cr√©ez un nouveau fichier, git n&#39;a pas connaissance de ce fichier. Si vous ne lui dites rien, il ne va rien faire avec. Il va bien d√©tecter que le fichier est nouveau, mais comme il n&#39;a aucune information dessus il ne peux rien dire d&#39;autre. Pour dire √† git de suivre (<em>track</em>) ce fichier vous allez devoir faire √©galement un <code>git add monFichier</code> ce qui va le mettre dans votre <em>staging index</em> et en plus git va commencer √† avoir des informations, donc si vous remodifiez votre fichier √† partir de maintenant git va d√©tecter que vous avez juste modifi√© le fichier. La suite du processus est la m√™me.</p>
<p>Voici un diagramme tir√© de la documentation officiel de git qui r√©sumer tout cela  (<a href='https://git-scm.com/book/en/v2/Git-Basics-Recording-Changes-to-the-Repository'>source</a>):</p>
<p><img src="https://git-scm.com/book/en/v2/images/lifecycle.png" referrerpolicy="no-referrer"></p>
<blockquote><p>üìñ En parlant de la documentation de git : git est l&#39;un des sujets les plus document√©s que je connaisse. Si vous √™tes bloqu√©s un jour faites une recherche sur le web et vous trouverez s√ªrement la solution √† votre probl√®me. </p>
</blockquote>
<h5>Et avec le d√©p√¥t distant</h5>
<p>Une autre mani√®re de voir le <em>workflow</em> de git est ne plus regarder le statut des fichiers mais comment passer d&#39;une zone git √† l&#39;autre (<a href='https://nceas.github.io/sasap-training/materials/reproducible_research_in_r_fairbanks/version-control-with-git-and-github.html'>source</a>): </p>
<p><img src="https://nceas.github.io/sasap-training/materials/reproducible_research_in_r_fairbanks/images/git-flowchart.png" referrerpolicy="no-referrer"></p>
<p>On va partir de votre zone de travail (<em>workspace</em>). Au fur et √† mesure de votre progression vous allez <em>stage</em> des fichiers et les envoyer dans le <em>staging index</em> avec des <code>git add</code>. Puis quand vous avez un code qui tourne (ou quand vous voulez) vous allez le <em>commit</em> pour cr√©er une entr√©e dans votre historique local avec un <code>git commit</code>. Et enfin si vous souhaitez envoyer votre code sur le serveur distant vous allez faire un <code>git push</code>. Et si vous voulez r√©cup√©rer le code du serveur distant vous allez faire un <code>git pull</code> pour tout r√©cup√©rer et mettre √† jour votre <em>workspace</em> ou un <code>git fetch</code> pour simplement r√©cup√©rer le code du d√©p√¥t distant sans modifier votre <em>workspace</em>, puis un <code>git merge</code> pour mettre √† jour votre <em>workspace</em> (dans certain cas proc√©der en deux temps est une meilleur solution qu&#39;en un temps).</p>
<p>Pour le moment git nous permet d&#39;avoir un historique de notre code et avec on peut retourner en arri√®re √† tout moment. Je ne vais pas trop rentrer dans les d√©tails, mais <strong>l&#39;historique de git est assez dur √† alt√©rer donc il n&#39;y aucun risque qu&#39;une version pr√©c√©dente du code ne soit perdue.</strong></p>
<h5>Et √† plusieurs ?</h5>
<p>Depuis le d√©but je fait comme si une seule personne travaillait sur un d√©p√¥t de code, ce qui n&#39;arrive presque jamais, et en g√©n√©ral plusieurs personnes travail en parall√®le sur le m√™me code. Et comme git repose sur sur une architecture d√©centralis√©e asynchrone, plusieurs version de votre application vont exister √† un m√™me moment :</p>
<ul>
<li>Celle du d√©p√¥t distant ;</li>
<li>Celle de chaque d√©p√¥t locaux sur les ordinateurs des diff√©rentes personnes qui ont r√©cup√©r√© le code.</li>

</ul>
<p>Et cela va potentiellement g√©n√©rer des conflits. Par exemple si Charles et Jake r√©cup√®rent le m√™me code mais que Jake <em>push</em> le premier lorsque Charles va vouloir push sont code il va avoir une erreur.</p>
<p><img src="https://raw.githubusercontent.com/HealerMikado/Cours-Ensai-Informatique/master/2A/complement_info/foad2/git%20d%C3%A9butant%20multi%20site.png" referrerpolicy="no-referrer" alt="Jake et Boyle r√©cup√®re un m√™me code du d√©p√¥t distant, et le modifie. Jake pousse son code le premier, et quand Charles veut faire de m√™me le d√©p√¥t distant refuse son code car les historiques ne correspondent pas"></p>
<p>Et cette erreur va √™tre : </p>
<pre><code> ! [rejected]        master -&gt; dev (fetch first)
error: failed to push some refs to &#39;https://charle.boyle@bitbucket.org/repo_user/repo_name.git&#39;
hint: Updates were rejected because the remote contains work that you do
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first integrate the remote changes
hint: (e.g., &#39;git pull ...&#39;) before pushing again.
hint: See the &#39;Note about fast-forwards&#39; in &#39;git push --help&#39; for details.
</code></pre>
<p>L&#39;erreur est assez parlante, on ne peut pas <em>push</em> car notre historique ne contient pas la derni√®re version du code. Et pour r√©soudre cela il faut faire un <code>git pull</code>.</p>
<p>D√©j√† une chose que montre bien le sch√©ma pr√©c√©dent c&#39;est qu&#39;avant le <em>push</em> de Jake il existe :</p>
<ul>
<li>Le code du d√©p√¥t distant</li>
<li>Le code de Jake</li>
<li>Le code de Charles</li>

</ul>
<p>Et tous ces codes sont parfaitement ind√©pendants et peuvent √™tre modifi√©s sans impacter les autres. Ainsi si vous vous prenez la t√™te sur une fonctionnalit√© compliqu√©e et que votre code refuse de fonctionner, cela ne p√©nalise pas les personnes qui travaillent sur leur propre code.</p>
<p>Voici le <em>workflow</em> complet dans le cas o√π quelqu&#39;un <em>push</em> son code avant vous. </p>
<p><img src="https://raw.githubusercontent.com/HealerMikado/Cours-Ensai-Informatique/master/2A/complement_info/foad2/git%20d%C3%A9butant%20multi%20site%20avec%20pull.png" referrerpolicy="no-referrer" alt="Jake et Boyle r√©cup√®re un m√™me code du d√©p√¥t distant, et le modifie. Jake pousse son code le premier, et quand Charles veut faire de m√™me le d√©p√¥t distant refuse son code car les historiques ne correspondent pas. Boyle doit alors pull le code du d√©p√¥t distant, g√©rer les conflits, puis faire git add, git commit et git push."></p>
<p>En fait il faut juste suivre les conseilles que vous affiche git et commencer par faire un <code>git pull</code>. L√† deux cas sont possibles :</p>
<ul>
<li>Le cas √† g√©rer √† la main : il y a un conflit car une zone de code que vous avez modifi√© a aussi √©t√© modifi√©e sur le d√©p√¥t distant. Cela va vous g√©n√©rer un conflit car git est incapable de choisir la version √† prendre. Surtout car vous allez peut-√™tre vouloir garder un m√©lange des deux. Il faut alors modifier le code √† la main, faire un <code>git add</code>, <code>git commit</code> pour fusionner les historiques et enfin faire un <code>git push</code> pour pousser le code sur le d√©p√¥t distant ;</li>
<li>Le cas que git peut g√©rer seul : il n&#39;y a pas de chevauchements dans les modifications, alors git fait un <em>fast forward</em>. Il met votre travail √† la suite de l&#39;historique qu&#39;il vient de r√©cup√©rer. Et vous pouvez <em>push</em> votre code directement</li>

</ul>
<p>Comme git emp√™che les op√©rations destructrices :</p>
<ul>
<li>La division/fusion de votre historique fait d√©sormais partie de l&#39;histoire de votre projet, et si on observe l&#39;historique on verra cette s√©paration de votre code entre le tronc et une branche pour ensuite fusionner la branche dans le tronc ;</li>
<li>Vous ne pouvez par perdre du travail que vous avez <em>commit</em>. Votre code sera toujours pr√©sent dans un commit et il est r√©cup√©rable. Peut-√™tre pas pour vous, mais pour votre tuteur de projet ou moi √ßa ne repr√©sente pas une grande difficult√©. Alors demandez-nous ! Et surtout faites des <em>commit</em> de votre travail ! Car on ne peut pas r√©cup√©rer un travail non <em>commit</em>.</li>

</ul>
<h3>Git crash course</h3>
<p>En compl√©ment je vous conseille cette vid√©o pour voir en pratique les concepts de ce cours. Vous pouvez faire les m√™me manipulation de la vid√©o pour vous entrainer √† utiliser git.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/SWYqp7iY_Tc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
<p>&nbsp;</p>
<h3>Ce qu&#39;il faut retenir</h3>
<ul>
<li>Pour r√©cup√©rer le code d&#39;un d√©p√¥t distant pour la premi√®re fois : <code>git clone url.du.d√©pot</code>, exemple <code>git clone https://github.com/HealerMikado/Cours-Ensai-Informatique.git</code> pour r√©cup√©rer le code de tous mes cours d&#39;informatique ;</li>
<li>Pour r√©cup√©rer un code plus r√©cent d&#39;un d√©p√¥t que vous avez d√©j√† t√©l√©charg√© : <code>git pull</code> ;</li>
<li>Pour mettre dans les fichiers dans le <em>staging index</em> : <code>git add file</code> pour mettre juste un fichier ou <code>git add .</code> pour tout mettre ;</li>
<li>Pour faire un <em>commit</em> avec tous les fichiers dans le <em>staging index</em> <code>git commit -m &quot;message&quot;</code> . Si vous oubliez le <code>-m &quot;message&quot;</code> un √©diteur Vim va s&#39;ouvrir et vous n&#39;allez pas arriver √† l&#39;utiliser ;</li>
<li>Pour pousser du code : <code>git push</code></li>
<li>Pour voir l&#39;√©tat de vos fichiers <code>git status</code></li>
<li>Pour voir votre historique &quot;joliment&quot; <code>git log --all --decorate --oneline --graph</code></li>
<li>Pour initier un d√©p√¥t git : <code>git init</code></li>
<li>Pour cr√©er une branche <code>git branch &quot;non de la branche&quot;</code></li>
<li>Pour passer d&#39;une branche √† l&#39;autre <code>git checkout nom de la branche</code></li>
<li>Pour fusionner deux branches, en √©tant sur la branche &quot;receveuse&quot; <code>git merge nom de la √† fusionner</code></li>

</ul>
<h3>Epilogue, git niveau expert</h3>
<p>Apr√®s 3 mois de d√©veloppement et la livraison de la premi√®re version de l&#39;application, Amy convoque l&#39;√©quipe pour proposer une nouvelle mani√®re de travailler pour limiter les conflits, rendre l&#39;historique plus propre,permettre des d√©veloppement vraiment en parall√®le et ajouter de l&#39;int√©gration continue pour ajouter des fonctionnalit√©s au fur et √† mesure. Elle veut mettre en place un vrai <em>git workflow</em> plus complexe √† base de <em>feature branch</em></p>
<p>Le principe va √™tre au lieu de tout mettre sur le m√™me branche <em>master</em> plusieurs branches vont √™tre cr√©√©e :</p>
<ul>
<li><p>La branche <em>master</em> contient le code de la production. D√©s qu&#39;un <em>commit</em> est fait dessus les tests du code sont jou√©s et si aucun test n&#39;a √©chou√© le code est automatiquement d√©ploy√© en production le soir. Chaque <em>commit</em> du <em>master</em> est tagu√© par un num√©ro de version ;</p>
</li>
<li><p>La branche <em>develop</em> contient le code en cours de d√©veloppement. D√©s qu&#39;un <em>commit</em> est fait dessus les tests du code sont jou√©s et si aucun test n&#39;a √©chou√© le code est automatiquement d√©ploy√© dans un environnement de d√©veloppement pour tester l&#39;application ;</p>
</li>
<li><p>Une <em>feature branch</em> est cr√©√©e pour d√©velopper chaque fonctionnalit√© de l&#39;application. Une fois le d√©veloppement de la fonctionnalit√© termin√© elle <em>merge</em> dans la branche <em>develop</em>.</p>
<p><img src="https://fr.lutece.paris.fr/fr/image?resource_type=wiki_image&amp;id=10" referrerpolicy="no-referrer"></p>
</li>

</ul>
<p>En plus pour pouvoir <em>merge</em> des branches (<em>feature</em> ‚Üí <em>develop</em>, <em>develop</em> ‚Üí <em>master</em>) il faut faire une <em>merge request</em> (ou <em>pull request</em>). Cela consiste √† faire une demande de fusion qui doit √™tre approuv√© par un ou plusieurs autres membres de l&#39;√©quipe. cela peut sembler lourd, mais √ßa oblige √† minima un autre membre de l&#39;√©quipe √† approuver la fusion, et permet de r√©partir les responsabilit√©s en cas de probl√®me. D&#39;autant plus qu&#39;en g√©n√©ral seul le chef de projet peut valider une <em>merge request</em> sur le <em>master</em>.</p>
<p>Ce fonctionnement permet d&#39;avoir une ind√©pendance totale dans le d√©veloppement des fonctionnalit√©s, de responsabiliser les membre de l&#39;√©quipe et d&#39;avoir du d√©ploiement continue, c&#39;est √† dire un code qui va automatiquement se d√©ployer sur des machines sans intervention humaine. C&#39;est une mani√®re de travailler de plus en plus courante dans le monde de l&#39;entreprise, qui doit √™tre associer √† une politique de test.</p>
<p>&nbsp;</p>
</body>
</html>